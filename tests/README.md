# MorizoAI テストスイート

このディレクトリには、MorizoAIの動作確認用テストが含まれています。

## テストファイル

### 1. `test_mcp_db.py`
**目的**: DB MCP Serverの各ツール動作確認

**テスト内容**:
- 在庫一覧取得
- 在庫追加（単一・複数）
- 在庫更新
- 在庫削除

**実行方法**:
```bash
python tests/test_mcp_db.py
```

### 2. `test_mcp_recipe.py`
**目的**: Recipe MCP Serverの各ツール動作確認

**テスト内容**:
- 献立生成（基本・在庫活用）
- RAG検索（基本・フィルタリング）
- Web検索（Perplexity API）

**実行方法**:
```bash
python tests/test_mcp_recipe.py
```

### 3. `test_integration.py`
**目的**: MorizoAI全体の統合テスト

**テスト内容**:
1. **挨拶パターン**: "こんにちは"
2. **在庫一覧取得**: "今の在庫を教えて"
3. **在庫挿入**: "豚バラブロックを1パックと、ほうれん草1束を買ってきたから、冷蔵庫に入れておいて"
4. **レシピ提案**: "今の在庫から作れる献立を教えて" ← **最重要目標**

**実行方法**:
```bash
# 1. サーバーを起動
python main.py

# 2. 別ターミナルで統合テストを実行
python tests/test_integration.py
```

## テストの特徴

- **明確な目的**: 各テストの役割が明確
- **実用的な内容**: デグレード防止と重要機能の確認
- **実行しやすい設計**: 手動実行、明確な出力

## テスト結果

### **MCPサーバー個別テスト**
- **DB MCP Server**: ✅ 5/5 テスト成功
- **Recipe MCP Server**: ✅ 5/5 テスト成功
  - 献立生成（基本・在庫活用）
  - RAG検索（基本・フィルタリング）
  - Web検索（Perplexity API）

### **統合テスト**
- **成功率**: 75% (3/4 シナリオ成功)
- ✅ **挨拶パターン**: 正常応答
- ✅ **在庫一覧取得**: 正常取得
- ✅ **在庫挿入**: 正常追加
- ⚠️ **レシピ提案**: 計画立案成功、依存関係エラーで失敗

### **技術的改善**
- **Perplexity API**: タイムアウト問題解決（60秒 + リトライ機能）
- **RAG検索**: 類似度閾値調整（0.3 → 0.2）で結果取得成功
- **フィルタリング**: カテゴリ・食材・類似度による絞り込み機能動作確認

## 注意事項

- **統合テスト**: `python main.py` でサーバーを起動した前提で実行
- **環境変数**: `.env` ファイルの設定が必要
  - `SUPABASE_ANON_KEY`: データベースアクセス用の認証トークン
  - `OPENAI_API_KEY`: OpenAI API キー
  - `PERPLEXITY_API_KEY`: Perplexity API キー
- **MCPサーバー**: 各MCPサーバーが正常に動作している必要
- **認証トークン**: 全てのDB MCPツールで `token` パラメータが必須

---

**作成者**: AIエージェント協働チーム  
**バージョン**: 1.1.0  
**最終更新**: 2025年9月26日
