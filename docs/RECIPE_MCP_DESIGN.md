# Morizo AI - ãƒ¬ã‚·ãƒ”ææ¡ˆæ©Ÿèƒ½ MCPè¨­è¨ˆ

## ğŸ“‹ æ¦‚è¦

ãƒ¬ã‚·ãƒ”ææ¡ˆæ©Ÿèƒ½ã®MCPï¼ˆMicro-Agent Communication Protocolï¼‰è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€‚åœ¨åº«é£Ÿæã‹ã‚‰ç‹¬å‰µçš„ãªãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç”Ÿæˆã—ã€Webæ¤œç´¢ã¨RAGæ¤œç´¢ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ¬ã‚·ãƒ”ã‚’ææ¡ˆã™ã‚‹æ©Ÿèƒ½ã®è¨­è¨ˆã€‚

## ğŸ§  è¨­è¨ˆæ€æƒ³ã®æ ¸å¿ƒ

### **æ ¹æœ¬çš„ãªå•é¡Œèªè­˜**
- **ç›®çš„**: å°‘ãªã„é£Ÿæã‹ã‚‰é£½ãã®æ¥ãªã„çŒ®ç«‹ã‚’ææ¡ˆ
- **åˆ¶ç´„**: LLMã«ã¯é­‚ã®ã“ã‚‚ã£ãŸãƒ¬ã‚·ãƒ”ä½œæˆãŒã§ããªã„
- **è§£æ±ºç­–**: äººé–“ãŒè“„ç©ã—ã¦ããŸãƒ¬ã‚·ãƒ”ã‚’å‚ç…§ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

### **æ¤œç´¢ã®å›ºå®šåŒ–å•é¡Œ**
- **å•é¡Œ**: å˜ç´”ãªãƒ¬ã‚·ãƒ”æ¤œç´¢ã§ã¯åŒã˜ã‚‚ã®ã°ã‹ã‚Šæ¤œç´¢ã—ã¦ã—ã¾ã†
- **åŸå› **: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¤œç´¢æ€è€ƒãŒå›ºå®šåŒ–
- **è§£æ±ºç­–**: LLMã«ç‹¬å‰µçš„ãªãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ¨è«–ã—ã¦ã‚‚ã‚‰ã†

### **ç‹¬å‰µæ€§ã¨æŠ‘åˆ¶ã®ãƒãƒ©ãƒ³ã‚¹**
- **LLMã®å½¹å‰²**: ç‹¬å‰µçš„ãªãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ã®æ¨è«–ï¼ˆé£½ãã®é˜²æ­¢ï¼‰
- **RAGã®å½¹å‰²**: è“„ç©ã—ãŸå³é¸ãƒ¬ã‚·ãƒ”ã‹ã‚‰ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŠ½å‡ºï¼ˆç‹¬å‰µæ€§ã®æŠ‘åˆ¶ï¼‰
- **æœªè§£æ±º**: ã©ã¡ã‚‰ã‚’æ¡ç”¨ã™ã‚‹ã‹ã®ãƒ­ã‚¸ãƒƒã‚¯

### **äººé–“ã®å¡æ™ºã¸ã®æ©‹æ¸¡ã—**
- **æœ€çµ‚æ®µéš**: WEBæ¤œç´¢ã§äººé–“ãŒä½œã£ãŸé­‚ã®ã“ã‚‚ã£ãŸãƒ¬ã‚·ãƒ”ã‚’æ¢ã™
- **MorizoAIã®å½¹å‰²**: LLMã®ç‹¬å‰µæ€§ã¨äººé–“ã®å¡æ™ºã®æ©‹æ¸¡ã—

### **å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®å†å®šç¾©**
```
1. LLMæ¨è«–: ç‹¬å‰µçš„ãªãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ã®ç”Ÿæˆï¼ˆé£½ãã®é˜²æ­¢ï¼‰
   â†“
2. RAGæ¤œç´¢: è“„ç©ãƒ¬ã‚·ãƒ”ã‹ã‚‰ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŠ½å‡ºï¼ˆç‹¬å‰µæ€§ã®æŠ‘åˆ¶ï¼‰
   â†“
3. æ¡ç”¨ãƒ­ã‚¸ãƒƒã‚¯: LLMææ¡ˆã¨RAGææ¡ˆã®é¸æŠï¼ˆæœªå®Ÿè£…ï¼‰
   â†“
4. WEBæ¤œç´¢: é¸æŠã•ã‚ŒãŸã‚¿ã‚¤ãƒˆãƒ«ã§äººé–“ã®ãƒ¬ã‚·ãƒ”ã‚’æ¤œç´¢
   â†“
5. çµ±åˆ: é­‚ã®ã“ã‚‚ã£ãŸãƒ¬ã‚·ãƒ”ã®æä¾›
```

## ğŸ¯ æ ¸å¿ƒæ€æƒ³

### **ã€Œé£½ããªã„çŒ®ç«‹ææ¡ˆã€ã®æœ¬è³ª**
- **å•é¡Œ**: å˜ç´”ãªãƒ¬ã‚·ãƒ”æ¤œç´¢ â†’ åŒã˜ã‚‚ã®ã®ç¹°ã‚Šè¿”ã—
- **è§£æ±º**: çŒ®ç«‹æ§‹æˆï¼ˆä¸»èœãƒ»å‰¯èœãƒ»æ±ç‰©ï¼‰+ éå»å±¥æ­´ç®¡ç† â†’ å¤šæ§˜ãªçŒ®ç«‹ææ¡ˆ
- **ä¾¡å€¤**: ãƒŸãƒ‹ãƒãƒªã‚¹ãƒˆå¯¾å¿œ + é£ŸæåŠ¹ç‡ + å±¥æ­´ç®¡ç† + æ–‡åŒ–çš„é©åˆ‡æ€§

### **è¨­è¨ˆã®æ ¸å¿ƒï¼ˆä¿®æ­£ç‰ˆï¼‰**
```
åœ¨åº«é£Ÿæ â†’ çŒ®ç«‹æ§‹æˆï¼ˆä¸»èœãƒ»å‰¯èœãƒ»æ±ç‰©ï¼‰ â†’ éå»å±¥æ­´ãƒã‚§ãƒƒã‚¯ â†’ ãƒ¬ã‚·ãƒ”æ¤œç´¢ â†’ çŒ®ç«‹ææ¡ˆ
```

### **åˆ¶ç´„æ¡ä»¶**
```python
MENU_CONSTRAINTS = {
    "dishes": ["ä¸»èœ", "å‰¯èœ", "æ±ç‰©"],
    "ingredient_exclusivity": "å„æ–™ç†ã§åŒã˜é£Ÿæã‚’ä½¿ç”¨ã—ãªã„",
    "history_exclusion": "éå»1-2é€±é–“ã®ãƒ¬ã‚·ãƒ”ã‚’é™¤å¤–",
    "simplicity": "æ „é¤Šãƒãƒ©ãƒ³ã‚¹ã¯å¾Œå›ã—ï¼ˆã‚·ãƒ³ãƒ—ãƒ«å„ªå…ˆï¼‰",
    "cultural_appropriateness": "çŒ®ç«‹ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦æ±ç‰©ã‚’é¸æŠï¼ˆå’Œé£Ÿâ†’å‘³å™Œæ±ã€æ´‹é£Ÿâ†’ã‚¹ãƒ¼ãƒ—ã€ä¸­è¯â†’ã‚¹ãƒ¼ãƒ—ï¼‰"
}
```

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### **è²¬ä»»åˆ†æ‹…**
- **ãƒ¡ã‚¤ãƒ³ReAct**: ã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ»åˆ¶å¾¡ã®è²¬ä»»
- **Recipe MCP**: ç´”ç²‹ãªãƒ„ãƒ¼ãƒ«æä¾›ã®ã¿
- **DB MCP**: åœ¨åº«ç®¡ç†ï¼ˆæ—¢å­˜ï¼‰

### **ãƒ„ãƒ¼ãƒ«æ§‹æˆï¼ˆçŒ®ç«‹ææ¡ˆç”¨ï¼‰**
```
1. generate_menu_plan: çŒ®ç«‹æ§‹æˆç”Ÿæˆ
2. check_cooking_history: éå»å±¥æ­´ãƒã‚§ãƒƒã‚¯
3. search_recipe_for_menu: çŒ®ç«‹ç”¨ãƒ¬ã‚·ãƒ”æ¤œç´¢
4. ï¼ˆçµ±åˆææ¡ˆæ©Ÿèƒ½ã¯å‰Šé™¤ï¼‰
```

## ğŸ”„ **è¨­è¨ˆã®é€²åŒ–ï¼ˆå£æ‰“ã¡çµæœï¼‰**

### **Phase 1å®Œäº†å¾Œã®è¨­è¨ˆè¦‹ç›´ã—**

#### **å•é¡Œç‚¹ã®ç™ºè¦‹**
1. **ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã®è¤‡é›‘ã•**: ã‚¿ã‚¹ã‚¯ã®é€”ä¸­ã§ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã«æˆ»ã‚‹æ©Ÿèƒ½ãŒãªã„
2. **å›ºå®šé †åºã®ç¹°ã‚Šè¿”ã—**: ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã¯åŒã˜é †åºã§çµæœã‚’è¿”ã™
3. **ReActãƒ«ãƒ¼ãƒ—ã®åˆ¶é™**: ç¾åœ¨ã®ReActãƒ«ãƒ¼ãƒ—ã¯å‹•çš„ãªãƒ—ãƒ©ãƒ³ä¿®æ­£ã«å¯¾å¿œã—ã¦ã„ãªã„

#### **RAGã®å½¹å‰²ã®æ˜ç¢ºåŒ–ï¼ˆå£æ‰“ã¡ã§æ•´ç†ï¼‰**
- **âœ… æ­£è§£**: RAGã§LLMã®ãƒ¬ã‚·ãƒ”ææ¡ˆã‚’**è£œä½**ã™ã‚‹
- **æœ¬æ¥ã®ç›®çš„**: ç¾å‘³ã—ã„ãƒ¬ã‚·ãƒ”ã®å³é¸æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ï¼ˆ6,233ä»¶ï¼‰ã‚’æ´»ç”¨
- **ãƒ‡ãƒ¼ã‚¿ã®å†…å®¹**: ã‚¿ã‚¤ãƒˆãƒ«ã€ææ–™ã€èª¿ç†æ‰‹é †ã‚’å«ã‚€å®Œå…¨ãªãƒ¬ã‚·ãƒ”æƒ…å ±
- **å®Ÿéš›ã®å½¹å‰²**: LLMãŒç”Ÿæˆã—ãŸãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ã®è©³ç´°æƒ…å ±ã‚’æä¾›
- **è£œä½ã®æ–¹æ³•**: é¡ä¼¼ãƒ¬ã‚·ãƒ”ã®æ¤œç´¢ã€ææ–™ã®ç¢ºèªã€èª¿ç†æ‰‹é †ã®æä¾›
- **Webæ¤œç´¢ã¨ã®ä½¿ã„åˆ†ã‘**: RAGã§è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®è©³ç´°å–å¾—
- **ç‹¬å‰µæ€§ã®æŠ‘åˆ¶**: è“„ç©ãƒ¬ã‚·ãƒ”ã‹ã‚‰ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŠ½å‡ºã—ã¦ç‹¬å‰µæ€§ã‚’é©åº¦ã«æŠ‘åˆ¶

#### **ä¿®æ­£ã•ã‚ŒãŸå‡¦ç†ãƒ•ãƒ­ãƒ¼**
```
ã‚µã‚¤ã‚¯ãƒ«1: inventory_list å®Ÿè¡Œ
ã‚µã‚¤ã‚¯ãƒ«2: generate_menu_plan_with_history å®Ÿè¡Œ
  â”œâ”€ åœ¨åº«é£Ÿæã‹ã‚‰çŒ®ç«‹ç”Ÿæˆ â† LLMãŒã‚¿ã‚¤ãƒˆãƒ«ã‚’ç”Ÿæˆ
  â”œâ”€ éå»å±¥æ­´ã‚’ãƒã‚§ãƒƒã‚¯ â† ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§å±¥æ­´ç¢ºèª
  â”œâ”€ é‡è¤‡ãŒã‚ã‚Œã°ä»£æ›¿æ¡ˆç”Ÿæˆ â† LLMãŒä»£æ›¿ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç”Ÿæˆ
  â””â”€ æœ€çµ‚çš„ãªçŒ®ç«‹ã‚’æ±ºå®š â† ã‚¿ã‚¤ãƒˆãƒ«ã®ã¿æ±ºå®š
ã‚µã‚¤ã‚¯ãƒ«3: search_recipe_for_menu å®Ÿè¡Œ (ä¸»èœ) â† Webæ¤œç´¢ã®ã¿
ã‚µã‚¤ã‚¯ãƒ«4: search_recipe_for_menu å®Ÿè¡Œ (å‰¯èœ) â† Webæ¤œç´¢ã®ã¿
ã‚µã‚¤ã‚¯ãƒ«5: search_recipe_for_menu å®Ÿè¡Œ (æ±ç‰©) â† Webæ¤œç´¢ã®ã¿
```

#### **è²¬ä»»åˆ†é›¢ã®æ˜ç¢ºåŒ–**
- **LLM**: å‰µé€ çš„ãªçŒ®ç«‹ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆ
- **RAG**: LLMã®æ¨è«–è£œä½ï¼ˆé¡ä¼¼ãƒ¬ã‚·ãƒ”ã®æ¤œç´¢ãƒ»é£Ÿæçµ„ã¿åˆã‚ã›ææ¡ˆãƒ»æ–‡åŒ–çš„é©åˆ‡æ€§å‘ä¸Šï¼‰
- **Web**: å…·ä½“çš„ãªãƒ¬ã‚·ãƒ”æƒ…å ±ã®å–å¾—ï¼ˆèª¿ç†æ‰‹é †ï¼‰

#### **æŠ€è¡“å®Ÿè£…ã¸ã®å½±éŸ¿**
- **LLMæ¨è«–ã®èª¿æ•´**: ç‹¬å‰µæ€§ã‚’é‡è¦–ã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆã€é£½ãã®é˜²æ­¢ã‚’æ„è­˜ã—ãŸå¤šæ§˜æ€§ã®ç¢ºä¿
- **RAGæ¤œç´¢ã®èª¿æ•´**: ç‹¬å‰µæ€§ã®æŠ‘åˆ¶ã‚’æ„è­˜ã—ãŸæ¤œç´¢æˆ¦ç•¥ã€è“„ç©ãƒ¬ã‚·ãƒ”ã‹ã‚‰ã®ã‚¿ã‚¤ãƒˆãƒ«æŠ½å‡ºæ©Ÿèƒ½
- **æ¡ç”¨ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…**: LLMææ¡ˆã¨RAGææ¡ˆã®è©•ä¾¡åŸºæº–ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å¥½ã¿ã®å­¦ç¿’æ©Ÿèƒ½
- **WEBæ¤œç´¢ã®èª¿æ•´**: äººé–“ã®ãƒ¬ã‚·ãƒ”ã®å“è³ªè©•ä¾¡ã€é­‚ã®ã“ã‚‚ã£ãŸãƒ¬ã‚·ãƒ”ã®è­˜åˆ¥

#### **ã“ã®è¨­è¨ˆæ€æƒ³ã®é‡è¦æ€§**
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š**: é£½ãã®æ¥ãªã„çŒ®ç«‹ææ¡ˆã€ç‹¬å‰µæ€§ã¨å®Ÿç”¨æ€§ã®ãƒãƒ©ãƒ³ã‚¹
- **æŠ€è¡“çš„å„ªä½æ€§**: LLMã®ç‹¬å‰µæ€§ã¨äººé–“ã®å¡æ™ºã®çµ„ã¿åˆã‚ã›
- **å·®åˆ¥åŒ–è¦å› **: å˜ç´”ãªãƒ¬ã‚·ãƒ”æ¤œç´¢ã¨ã®é•ã„ã€AIã¨äººé–“ã®å”åƒã«ã‚ˆã‚‹æ–°ã—ã„ä¾¡å€¤å‰µé€ 

## ğŸ› ï¸ MCPãƒ„ãƒ¼ãƒ«è¨­è¨ˆï¼ˆä¿®æ­£ç‰ˆï¼‰

### **1. generate_menu_plan_with_historyï¼ˆçŒ®ç«‹æ§‹æˆç”Ÿæˆï¼‰**

#### **ä»•æ§˜ï¼ˆä¿®æ­£ç‰ˆï¼‰**
```python
@mcp.tool()
async def generate_menu_plan_with_history(
    inventory_items: List[str],
    user_id: str,
    menu_type: str = "å’Œé£Ÿ"
) -> Dict[str, Any]:
    """
    åœ¨åº«é£Ÿæã‹ã‚‰çŒ®ç«‹æ§‹æˆã‚’ç”Ÿæˆï¼ˆéå»å±¥æ­´ã‚’è€ƒæ…®ï¼‰
    
    Args:
        inventory_items: åœ¨åº«é£Ÿæãƒªã‚¹ãƒˆ
        user_id: ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆå±¥æ­´ãƒã‚§ãƒƒã‚¯ç”¨ï¼‰
        menu_type: çŒ®ç«‹ã®ã‚¿ã‚¤ãƒ—
    
    Returns:
        {
            "main_dish": {
                "title": "ç‰›ä¹³ã¨åµã®ãƒ•ãƒ¬ãƒ³ãƒãƒˆãƒ¼ã‚¹ãƒˆ",
                "ingredients": ["ç‰›ä¹³", "åµ", "ãƒ‘ãƒ³", "ãƒã‚¿ãƒ¼"]
            },
            "side_dish": {
                "title": "ã»ã†ã‚Œã‚“è‰ã®èƒ¡éº»å’Œãˆ",
                "ingredients": ["ã»ã†ã‚Œã‚“è‰", "èƒ¡éº»", "é†¤æ²¹"]
            },
            "soup": {
                "title": "ç™½èœã¨ãƒãƒ ã®ã‚¯ãƒªãƒ¼ãƒ ã‚¹ãƒ¼ãƒ—",
                "ingredients": ["ç™½èœ", "ãƒãƒ ", "ç‰›ä¹³", "ãƒã‚¿ãƒ¼", "å°éº¦ç²‰"]
            },
            "ingredient_usage": {
                "used": ["ç‰›ä¹³", "åµ", "ãƒ‘ãƒ³", "ãƒã‚¿ãƒ¼", "ã»ã†ã‚Œã‚“è‰", "èƒ¡éº»", "ç™½èœ", "ãƒãƒ ", "å°éº¦ç²‰"],
                "remaining": []
            },
            "excluded_recipes": ["ãƒ•ãƒ¬ãƒ³ãƒãƒˆãƒ¼ã‚¹ãƒˆ", "ã‚ªãƒ ãƒ¬ãƒ„"],
            "fallback_used": true
        }
    """
```

#### **å‡¦ç†ãƒ•ãƒ­ãƒ¼**
```python
async def generate_menu_plan_with_history(inventory_items, user_id, menu_type):
    # 1. LLMãŒçŒ®ç«‹å€™è£œã‚’ç”Ÿæˆ
    menu_candidates = await llm_generate_menu_candidates(inventory_items)
    
    # 2. RAGã§é¡ä¼¼ãƒ¬ã‚·ãƒ”ã‚’æ¤œç´¢ï¼ˆLLMè£œä½ï¼‰
    rag_suggestions = await rag_search_similar_recipes(menu_candidates)
    
    # 3. LLMãŒRAGã®çµæœã‚’å‚è€ƒã«æœ€çµ‚çš„ãªçŒ®ç«‹ã‚’æ±ºå®š
    final_menu = await llm_decide_final_menu(menu_candidates, rag_suggestions)
    
    # 4. éå»å±¥æ­´ã‚’ãƒã‚§ãƒƒã‚¯
    recent_recipes = await get_recent_recipes(user_id, 14)
    
    # 5. é‡è¤‡ãŒã‚ã‚Œã°ä»£æ›¿æ¡ˆç”Ÿæˆ
    if has_overlap(final_menu, recent_recipes):
        alternative_menu = await llm_generate_alternative_menu(
            inventory_items, 
            exclude_recipes=recent_recipes
        )
        return alternative_menu
    
    return final_menu
```

### **2. check_cooking_historyï¼ˆéå»å±¥æ­´ãƒã‚§ãƒƒã‚¯ï¼‰**

#### **ä»•æ§˜**
```python
@mcp.tool()
async def check_cooking_history(
    user_id: str,
    recipe_titles: List[str],
    exclusion_days: int = 14
) -> Dict[str, Any]:
    """
    éå»ã®èª¿ç†å±¥æ­´ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦é‡è¤‡ã‚’å›é¿
    
    Args:
        user_id: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
        recipe_titles: ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ãƒªã‚¹ãƒˆ
        exclusion_days: é™¤å¤–ã™ã‚‹æ—¥æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ14æ—¥ï¼‰
    
    Returns:
        {
            "excluded_recipes": [
                {
                    "title": "é¶ã‚‚ã‚‚è‚‰ã®ç…§ã‚Šç„¼ã",
                    "cooked_at": "2025-01-15",
                    "days_ago": 5,
                    "reason": "éå»14æ—¥ä»¥å†…ã«èª¿ç†æ¸ˆã¿"
                }
            ],
            "available_recipes": [
                {
                    "title": "è±šè‚‰ã®ç”Ÿå§œç„¼ã",
                    "status": "available"
                }
            ],
            "exclusion_summary": {
                "total_checked": 3,
                "excluded_count": 1,
                "available_count": 2
            }
        }
    """
```

#### **ç‹¬å‰µæ€§åˆ¶å¾¡**
```python
CREATIVITY_LEVELS = {
    1: {
        "name": "ä¿å®ˆçš„",
        "description": "å®šç•ªã®çµ„ã¿åˆã‚ã›",
        "examples": ["ç‰›ä¹³ã¨åµã®ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«ã‚¨ãƒƒã‚°", "ãƒ‘ãƒ³ã¨ãƒã‚¿ãƒ¼ã®ãƒˆãƒ¼ã‚¹ãƒˆ"]
    },
    2: {
        "name": "æ¨™æº–",
        "description": "å°‘ã—å·¥å¤«ã—ãŸçµ„ã¿åˆã‚ã›",
        "examples": ["ç‰›ä¹³ã¨åµã®ãƒ•ãƒ¬ãƒ³ãƒãƒˆãƒ¼ã‚¹ãƒˆ", "ãƒ‘ãƒ³ã¨ãƒã‚¿ãƒ¼ã®ã‚¬ãƒ¼ãƒªãƒƒã‚¯ãƒˆãƒ¼ã‚¹ãƒˆ"]
    },
    3: {
        "name": "ç‹¬å‰µçš„",
        "description": "å‰µé€ çš„ãªçµ„ã¿åˆã‚ã›",
        "examples": ["ç‰›ä¹³ã¨åµã®å’Œé¢¨ãƒ•ãƒ¬ãƒ³ãƒãƒˆãƒ¼ã‚¹ãƒˆ", "ãƒ‘ãƒ³ã¨ãƒã‚¿ãƒ¼ã®ãƒãƒ¼ãƒ–ãƒˆãƒ¼ã‚¹ãƒˆ"]
    },
    4: {
        "name": "é©æ–°çš„",
        "description": "éå¸¸ã«ç‹¬å‰µçš„ãªçµ„ã¿åˆã‚ã›",
        "examples": ["ç‰›ä¹³ã¨åµã®åˆ†å­ã‚¬ã‚¹ãƒˆãƒ­ãƒãƒŸãƒ¼é¢¨ãƒ‡ã‚¶ãƒ¼ãƒˆ", "ãƒ‘ãƒ³ã¨ãƒã‚¿ãƒ¼ã®ã‚¢ãƒ¼ãƒˆé¢¨ãƒˆãƒ¼ã‚¹ãƒˆ"]
    }
}
```

#### **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ**
```python
RECIPE_GENERATION_PROMPT = """
ã‚ãªãŸã¯å‰µé€ çš„ãªãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ç”ŸæˆAIã§ã™ã€‚

åœ¨åº«é£Ÿæ: {inventory_items}
ç‹¬å‰µæ€§ãƒ¬ãƒ™ãƒ«: {creativity_level} ({creativity_description})
èª¿ç†æ™‚é–“: {cooking_time}
é›£æ˜“åº¦: {difficulty}
æ–™ç†ã‚¹ã‚¿ã‚¤ãƒ«: {cuisine_style}

åˆ¶ç´„:
- åœ¨åº«é£Ÿæã®ã¿ã‚’ä½¿ç”¨
- å®¶åº­ã§ä½œã‚Œã‚‹ãƒ¬ãƒ™ãƒ«ã®ç‹¬å‰µæ€§
- å®Ÿç”¨çš„ã§ç¾å‘³ã—ã„ãƒ¬ã‚·ãƒ”
- æ—¥æœ¬èªã§å›ç­”

ç”Ÿæˆã™ã‚‹ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ1ã¤ï¼‰:
"""
```

### **3. search_recipe_for_menuï¼ˆçŒ®ç«‹ç”¨ãƒ¬ã‚·ãƒ”æ¤œç´¢ï¼‰**

#### **ä»•æ§˜ï¼ˆä¿®æ­£ç‰ˆï¼‰**
```python
@mcp.tool()
async def search_recipe_for_menu(
    dish_type: str,  # "ä¸»èœ", "å‰¯èœ", "æ±ç‰©"
    title: str,
    available_ingredients: List[str],
    excluded_ingredients: List[str] = None
) -> Dict[str, Any]:
    """
    çŒ®ç«‹ç”¨ã®ãƒ¬ã‚·ãƒ”æ¤œç´¢ï¼ˆWebæ¤œç´¢ã®ã¿ï¼‰
    
    Args:
        dish_type: æ–™ç†ã®ç¨®é¡
        title: æ¤œç´¢ã™ã‚‹ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«
        available_ingredients: ä½¿ç”¨å¯èƒ½ãªé£Ÿæ
        excluded_ingredients: ä½¿ç”¨ç¦æ­¢é£Ÿæï¼ˆä»–ã®æ–™ç†ã§ä½¿ç”¨æ¸ˆã¿ï¼‰
    
    Returns:
        {
            "recipe": {
                "title": "ç‰›ä¹³ã¨åµã®ãƒ•ãƒ¬ãƒ³ãƒãƒˆãƒ¼ã‚¹ãƒˆ",
                "ingredients": ["ç‰›ä¹³", "åµ", "ãƒ‘ãƒ³", "ãƒã‚¿ãƒ¼"],
                "instructions": "1. ç‰›ä¹³ã¨åµã‚’æ··ãœã‚‹...",
                "source": "cookpad",
                "url": "https://cookpad.com/recipe/789012"
            },
            "ingredient_compatibility": {
                "available": ["ç‰›ä¹³", "åµ", "ãƒ‘ãƒ³", "ãƒã‚¿ãƒ¼"],
                "missing": [],
                "excluded": ["ã»ã†ã‚Œã‚“è‰", "è±†è…"]  # ä»–ã®æ–™ç†ã§ä½¿ç”¨æ¸ˆã¿
            }
        }
    """
```

#### **å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆä¿®æ­£ç‰ˆï¼‰**
```python
async def search_recipe_for_menu(dish_type, title, available_ingredients, excluded_ingredients):
    # 1. Webæ¤œç´¢ã§ãƒ¬ã‚·ãƒ”ã‚’æ¤œç´¢
    web_results = await web_search_recipe(title)
    
    # 2. é£Ÿæã®äº’æ›æ€§ã‚’ãƒã‚§ãƒƒã‚¯
    compatible_recipes = filter_by_ingredients(web_results, available_ingredients, excluded_ingredients)
    
    # 3. æœ€é©ãªãƒ¬ã‚·ãƒ”ã‚’é¸æŠ
    best_recipe = select_best_recipe(compatible_recipes, dish_type)
    
    return best_recipe
```

#### **å†…éƒ¨å®Ÿè£…æˆ¦ç•¥**
```python
SEARCH_STRATEGY = {
    "step1": "web_search_primary",
    "step2": "rag_search_secondary", 
    "step3": "result_integration",
    "step4": "similarity_ranking"
}
```

## ğŸ” Webæ¤œç´¢ã®å®Ÿè£…

### **æ³•çš„ãƒªã‚¹ã‚¯ã®è»½æ¸›**
- **ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å›é¿**: æœ‰æ–™ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¦ç´„å¤–åˆ©ç”¨ã‚’é¿ã‘ã‚‹
- **APIåˆ©ç”¨**: Google Search APIç­‰ã®å…¬å¼APIä½¿ç”¨
- **è¦ç´„ã®ã¿**: å®Œå…¨ãªãƒ¬ã‚·ãƒ”å†…å®¹ã¯å–å¾—ã—ãªã„
- **ãƒªãƒ³ã‚¯æä¾›**: å…ƒã‚µã‚¤ãƒˆã¸ã®èª˜å°ã®ã¿

### **æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³APIã®åˆ©ç”¨**
```python
WEB_SEARCH_STRATEGY = {
    "primary": "google_search_api",
    "fallback": "bing_search_api",
    "method": "api_based_search",
    "content_type": "title_and_url_only"
}
```

### **æ¤œç´¢çµæœã®å‡¦ç†**
```python
SEARCH_RESULT_PROCESSING = {
    "extract": ["title", "url", "snippet"],
    "avoid": ["full_content", "images", "detailed_instructions"],
    "legal_safe": True
}
```

### **Google Search APIè¨­å®š**
```python
GOOGLE_SEARCH_CONFIG = {
    "api_key": "GOOGLE_SEARCH_API_KEY",
    "search_engine_id": "CUSTOM_SEARCH_ENGINE_ID",
    "search_type": "web",
    "safe_search": "active",
    "num_results": 10
}
```

### **æ¤œç´¢ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–**
```python
SEARCH_QUERY_OPTIMIZATION = {
    "base_query": "ãƒ¬ã‚·ãƒ” {title}",
    "site_specific": [
        "site:cookpad.com ãƒ¬ã‚·ãƒ” {title}",
        "site:delishkitchen.tv ãƒ¬ã‚·ãƒ” {title}",
        "site:kurashiru.com ãƒ¬ã‚·ãƒ” {title}"
    ],
    "fallback_query": "ãƒ¬ã‚·ãƒ” {title} ä½œã‚Šæ–¹"
}
```

## ğŸ—„ï¸ RAGæ¤œç´¢ã®å®Ÿè£…ï¼ˆLLMè£œä½æ©Ÿèƒ½ï¼‰

### **RAGã®è£œä½æ©Ÿèƒ½**
- **ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ã®ç²¾åº¦å‘ä¸Š**: æ—¢å­˜ã®ç¾å‘³ã—ã„ãƒ¬ã‚·ãƒ”ã‚’å‚è€ƒ
- **é£Ÿæã®çµ„ã¿åˆã‚ã›ææ¡ˆ**: å®Ÿéš›ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹çµ„ã¿åˆã‚ã›ã‚’å­¦ç¿’
- **æ–‡åŒ–çš„é©åˆ‡æ€§**: æ—¥æœ¬ã®é£Ÿæ–‡åŒ–ã«åˆã£ãŸææ¡ˆ

### **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®æ´»ç”¨**
- **ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**: `me2you/recipe_data.jsonl` (6,234ä»¶ã®ãƒ¬ã‚·ãƒ”)
- **ãƒ‡ãƒ¼ã‚¿æ§‹é€ **: ã‚¿ã‚¤ãƒˆãƒ«ã€é£Ÿæãƒªã‚¹ãƒˆã€åˆ†é¡æƒ…å ±
- **æ³•çš„å®‰å…¨æ€§**: éå»ã«å–å¾—æ¸ˆã¿ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿

### **ãƒ‡ãƒ¼ã‚¿æ§‹é€ **
```json
{
  "text": "ä»¥ä¸‹ã®ãƒ¬ã‚·ãƒ”ã®åˆ†é¡ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚\n\n[ãƒ¬ã‚·ãƒ”æœ¬æ–‡]\n(title)ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ« (ingredientText)é£Ÿæãƒªã‚¹ãƒˆ\n[å›ç­”]\n{\"ãƒ¬ã‚·ãƒ”åˆ†é¡\":\"ä¸»èœ\",\"ä¸»ææ–™\":[\"é£Ÿæ1\",\"é£Ÿæ2\"],\"ã‚«ãƒ†ã‚´ãƒª\":\"ãŠã‹ãšè‚‰ã˜ã‚ƒãŒ\"}"
}
```

### **ãƒ™ã‚¯ãƒˆãƒ«DBæ§‹ç¯‰æˆ¦ç•¥**

#### **äº‹å‰ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**
- **æ¯å›APIå‘¼ã³å‡ºã—å›é¿**: æ¤œç´¢ã®ãŸã³ã«OpenAI APIã‚’å‘¼ã³å‡ºã•ãªã„
- **ã‚³ã‚¹ãƒˆå‰Šæ¸›**: 99.98%ã®ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼ˆæœˆé¡$1,870 â†’ $0.30ï¼‰
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“å‘ä¸Š**: APIå‘¼ã³å‡ºã—ã«ã‚ˆã‚‹é…å»¶ã‚’æ’é™¤
- **å¯ç”¨æ€§å‘ä¸Š**: OpenAI APIã®åˆ¶é™ã‚„éšœå®³ã®å½±éŸ¿ã‚’å›é¿

#### **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆé–‹ç™ºæ®µéšï¼‰**
```python
# LangChain + Chromaï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
- ç°¡å˜ãªå®Ÿè£…
- ç„¡æ–™
- é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆã«æœ€é©
- æ°¸ç¶šåŒ–æ©Ÿèƒ½
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ¤œç´¢
```

#### **ãƒ™ã‚¯ãƒˆãƒ«åŒ–å¯¾è±¡**
```python
VECTORIZATION_TARGETS = {
    "title": {
        "weight": 0.4,
        "description": "ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–"
    },
    "ingredientText": {
        "weight": 0.3,
        "description": "é£Ÿæãƒªã‚¹ãƒˆã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–"
    },
    "recipe_category": {
        "weight": 0.2,
        "description": "ãƒ¬ã‚·ãƒ”åˆ†é¡ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–"
    },
    "main_ingredients": {
        "weight": 0.1,
        "description": "ä¸»ææ–™ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–"
    }
}
```

#### **ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æœ€é©åŒ–**
```python
RECIPE_VECTOR_STRUCTURE = {
    "id": "recipe_001",
    "title": "ç‰›ä¹³ã¨åµã®ãƒ•ãƒ¬ãƒ³ãƒãƒˆãƒ¼ã‚¹ãƒˆ",
    "ingredients": ["ç‰›ä¹³", "åµ", "ãƒ‘ãƒ³", "ãƒã‚¿ãƒ¼"],
    "combined_text": "ç‰›ä¹³ã¨åµã®ãƒ•ãƒ¬ãƒ³ãƒãƒˆãƒ¼ã‚¹ãƒˆ ç‰›ä¹³ åµ ãƒ‘ãƒ³ ãƒã‚¿ãƒ¼ ä¸»èœ",
    "metadata": {
        "recipe_category": "ä¸»èœ",
        "main_ingredients": ["ç‰›ä¹³", "åµ"],
        "category": "ãŠã‹ãšãƒ•ãƒ¬ãƒ³ãƒãƒˆãƒ¼ã‚¹ãƒˆ"
    }
}
```

#### **ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã®æˆ¦ç•¥**
```python
VECTORIZATION_STRATEGY = {
    "text_combination": "title + ingredients + category",
    "weighting": {
        "title": 0.4,
        "ingredients": 0.3,
        "category": 0.3
    },
    "preprocessing": [
        "normalize_text",
        "remove_special_chars",
        "standardize_ingredients"
    ]
}
```

### **åœ¨åº«é£Ÿæã¨ã®ãƒãƒƒãƒãƒ³ã‚°**
```python
INVENTORY_MATCHING_LOGIC = {
    "exact_match": {
        "priority": 1,
        "description": "åœ¨åº«é£Ÿæã¨å®Œå…¨ä¸€è‡´"
    },
    "partial_match": {
        "priority": 2,
        "description": "åœ¨åº«é£Ÿæã®ä¸€éƒ¨ä¸€è‡´"
    },
    "category_match": {
        "priority": 3,
        "description": "é£Ÿæã‚«ãƒ†ã‚´ãƒªã®ä¸€è‡´"
    },
    "fallback": {
        "priority": 4,
        "description": "é¡ä¼¼é£Ÿæã§ã®æ¤œç´¢"
    }
}
```

### **é£Ÿææ­£è¦åŒ–**
```python
INGREDIENT_NORMALIZATION = {
    "ç‰›ä¹³": ["ç‰›ä¹³", "ãƒŸãƒ«ã‚¯", "ä¹³"],
    "åµ": ["åµ", "ãŸã¾ã”", "ç‰å­"],
    "ãƒ‘ãƒ³": ["ãƒ‘ãƒ³", "é£Ÿãƒ‘ãƒ³", "ãƒ–ãƒ¬ãƒƒãƒ‰"],
    "ãƒã‚¿ãƒ¼": ["ãƒã‚¿ãƒ¼", "ãƒãƒ¼ã‚¬ãƒªãƒ³", "æ²¹è„‚"]
}
```

### **ãƒãƒƒãƒãƒ³ã‚°ã‚¹ã‚³ã‚¢è¨ˆç®—**
```python
MATCHING_SCORE_CALCULATION = {
    "exact_match": 1.0,
    "partial_match": 0.8,
    "category_match": 0.6,
    "similarity_match": 0.4
}
```

## ğŸš€ å®Ÿè£…ã®æ®µéš

### **Phase 1: ãƒ™ã‚¯ãƒˆãƒ«DBæ§‹ç¯‰ï¼ˆäº‹å‰å‡¦ç†ï¼‰**
1. **ãƒ¬ã‚·ãƒ”ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†**: `me2you/recipe_data.jsonl`ã®è§£æãƒ»æ­£è¦åŒ–
2. **ãƒ™ã‚¯ãƒˆãƒ«åŒ–**: LangChain + Chromaã«ã‚ˆã‚‹ãƒ™ã‚¯ãƒˆãƒ«DBæ§‹ç¯‰
3. **æ°¸ç¶šåŒ–**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ã¸ã®ä¿å­˜

### **Phase 2: åŸºæœ¬çŒ®ç«‹æ©Ÿèƒ½**
1. **`generate_menu_plan`**: ã‚·ãƒ³ãƒ—ãƒ«ãªçŒ®ç«‹æ§‹æˆç”Ÿæˆ
2. **`check_cooking_history`**: éå»å±¥æ­´ãƒã‚§ãƒƒã‚¯
3. **é£Ÿæé…åˆ†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **: é‡è¤‡å›é¿ã®ãƒ­ã‚¸ãƒƒã‚¯

### **Phase 3: ãƒ¬ã‚·ãƒ”æ¤œç´¢æ©Ÿèƒ½**
1. **`search_recipe_for_menu`**: çŒ®ç«‹ç”¨ãƒ¬ã‚·ãƒ”æ¤œç´¢
2. **é£Ÿæåˆ¶ç´„**: ä½¿ç”¨ç¦æ­¢é£Ÿæã®è€ƒæ…®
3. **çµ±åˆæ¤œç´¢**: Web + RAG ã®çµ±åˆ

### **Phase 4: çµ±åˆææ¡ˆæ©Ÿèƒ½**
1. **å®Œå…¨ãªçŒ®ç«‹ææ¡ˆ**: å±¥æ­´é™¤å¤–æ¸ˆã¿ã®çŒ®ç«‹
2. **ä»£æ›¿æ¡ˆç”Ÿæˆ**: è¤‡æ•°ã®çŒ®ç«‹ãƒ‘ã‚¿ãƒ¼ãƒ³
3. **è²·ã„ç‰©ææ¡ˆ**: ä¸è¶³é£Ÿæã®ææ¡ˆ

## ğŸ¯ æœ¬ä½“ReActãƒ«ãƒ¼ãƒ—ã§ã®ä½¿ç”¨ä¾‹ï¼ˆä¿®æ­£ç‰ˆï¼‰

### **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```
"å†·è”µåº«ã®é£Ÿæã§ä»Šæ—¥ã®çŒ®ç«‹ã‚’ææ¡ˆã—ã¦ï¼"
```

### **ActionPlannerï¼ˆã‚¿ã‚¹ã‚¯åˆ†è§£ï¼‰**
```json
{
  "tasks": [
    {
      "description": "ç¾åœ¨ã®åœ¨åº«ã‚’ç¢ºèª",
      "tool": "inventory_list",
      "parameters": {},
      "priority": 1
    },
    {
      "description": "åœ¨åº«é£Ÿæã‹ã‚‰çŒ®ç«‹æ§‹æˆã‚’ç”Ÿæˆï¼ˆéå»å±¥æ­´ã‚’è€ƒæ…®ï¼‰",
      "tool": "generate_menu_plan_with_history",
      "parameters": {
        "inventory_items": "{{task1_result}}",
        "user_id": "{{user_id}}",
        "menu_type": "å’Œé£Ÿ"
      },
      "priority": 2,
      "dependencies": ["task1"]
    },
    {
      "description": "ä¸»èœã®ãƒ¬ã‚·ãƒ”ã‚’æ¤œç´¢",
      "tool": "search_recipe_for_menu",
      "parameters": {
        "dish_type": "ä¸»èœ",
        "title": "{{task2_result.main_dish.title}}",
        "available_ingredients": "{{task2_result.main_dish.ingredients}}",
        "excluded_ingredients": "{{task2_result.side_dish.ingredients + task2_result.soup.ingredients}}"
      },
      "priority": 3,
      "dependencies": ["task2"]
    },
    {
      "description": "å‰¯èœã®ãƒ¬ã‚·ãƒ”ã‚’æ¤œç´¢",
      "tool": "search_recipe_for_menu",
      "parameters": {
        "dish_type": "å‰¯èœ",
        "title": "{{task2_result.side_dish.title}}",
        "available_ingredients": "{{task2_result.side_dish.ingredients}}",
        "excluded_ingredients": "{{task2_result.main_dish.ingredients + task2_result.soup.ingredients}}"
      },
      "priority": 4,
      "dependencies": ["task2"]
    },
    {
      "description": "æ±ç‰©ã®ãƒ¬ã‚·ãƒ”ã‚’æ¤œç´¢",
      "tool": "search_recipe_for_menu",
      "parameters": {
        "dish_type": "æ±ç‰©",
        "title": "{{task2_result.soup.title}}",
        "available_ingredients": "{{task2_result.soup.ingredients}}",
        "excluded_ingredients": "{{task2_result.main_dish.ingredients + task2_result.side_dish.ingredients}}"
      },
      "priority": 5,
      "dependencies": ["task2"]
    }
  ]
}
```

### **TaskManagerï¼ˆã‚¿ã‚¹ã‚¯å®Ÿè¡Œï¼‰**
```
ã‚µã‚¤ã‚¯ãƒ«1: inventory_list å®Ÿè¡Œ
ã‚µã‚¤ã‚¯ãƒ«2: generate_menu_plan_with_history å®Ÿè¡Œ
  â”œâ”€ åœ¨åº«é£Ÿæã‹ã‚‰çŒ®ç«‹ç”Ÿæˆ â† LLMãŒã‚¿ã‚¤ãƒˆãƒ«ã‚’ç”Ÿæˆ
  â”œâ”€ éå»å±¥æ­´ã‚’ãƒã‚§ãƒƒã‚¯ â† ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§å±¥æ­´ç¢ºèª
  â”œâ”€ é‡è¤‡ãŒã‚ã‚Œã°ä»£æ›¿æ¡ˆç”Ÿæˆ â† LLMãŒä»£æ›¿ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç”Ÿæˆ
  â””â”€ æœ€çµ‚çš„ãªçŒ®ç«‹ã‚’æ±ºå®š â† ã‚¿ã‚¤ãƒˆãƒ«ã®ã¿æ±ºå®š
ã‚µã‚¤ã‚¯ãƒ«3: search_recipe_for_menu å®Ÿè¡Œ (ä¸»èœ) â† Webæ¤œç´¢ã®ã¿
ã‚µã‚¤ã‚¯ãƒ«4: search_recipe_for_menu å®Ÿè¡Œ (å‰¯èœ) â† Webæ¤œç´¢ã®ã¿
ã‚µã‚¤ã‚¯ãƒ«5: search_recipe_for_menu å®Ÿè¡Œ (æ±ç‰©) â† Webæ¤œç´¢ã®ã¿
```

### **æœ€çµ‚å¿œç­”ç”Ÿæˆ**
```
"ä»Šæ—¥ã®çŒ®ç«‹ã‚’ã”ææ¡ˆã—ã¾ã™ï¼ï¼ˆéå»14æ—¥é–“ã®é‡è¤‡ã‚’å›é¿ï¼‰

ã€ä¸»èœã€‘ç‰›ä¹³ã¨åµã®ãƒ•ãƒ¬ãƒ³ãƒãƒˆãƒ¼ã‚¹ãƒˆ
ã€å‰¯èœã€‘ã»ã†ã‚Œã‚“è‰ã®èƒ¡éº»å’Œãˆ  
ã€æ±ç‰©ã€‘ç™½èœã¨ãƒãƒ ã®ã‚¯ãƒªãƒ¼ãƒ ã‚¹ãƒ¼ãƒ—

ä½¿ç”¨é£Ÿæ: ç‰›ä¹³ã€åµã€ãƒ‘ãƒ³ã€ãƒã‚¿ãƒ¼ã€ã»ã†ã‚Œã‚“è‰ã€èƒ¡éº»ã€ç™½èœã€ãƒãƒ ã€å°éº¦ç²‰
æ®‹ã‚Šé£Ÿæ: ãªã—

â€»éå»14æ—¥é–“ã§èª¿ç†ã—ãŸãƒ¬ã‚·ãƒ”ã¯é™¤å¤–ã—ã¦ã„ã¾ã™"
```

## âš–ï¸ æ³•çš„ãƒªã‚¹ã‚¯ã®è»½æ¸›ç­–

### **1. åˆ©ç”¨è¦ç´„ã®éµå®ˆ**
- **APIåˆ©ç”¨**: å…¬å¼APIã®åˆ©ç”¨è¦ç´„éµå®ˆ
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: é©åˆ‡ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆé »åº¦
- **åˆ©ç”¨ç›®çš„**: å€‹äººåˆ©ç”¨ãƒ»ç ”ç©¶ç›®çš„ã®æ˜è¨˜

### **2. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å–ã‚Šæ‰±ã„**
- **è¦ç´„ã®ã¿**: å®Œå…¨ãªãƒ¬ã‚·ãƒ”å†…å®¹ã¯å–å¾—ã—ãªã„
- **ãƒªãƒ³ã‚¯æä¾›**: å…ƒã‚µã‚¤ãƒˆã¸ã®èª˜å°ã®ã¿
- **å‡ºå…¸æ˜è¨˜**: æƒ…å ±æºã®æ˜ç¢ºãªè¡¨ç¤º

### **3. ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†**
- **æœ€å°é™ã®ä¿å­˜**: å¿…è¦æœ€å°é™ã®æƒ…å ±ã®ã¿
- **å®šæœŸå‰Šé™¤**: å¤ã„æ¤œç´¢çµæœã®å‰Šé™¤
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼**: å€‹äººæƒ…å ±ã®ä¿è­·

## ğŸ¯ ã“ã®è¨­è¨ˆã®åˆ©ç‚¹

### **ã‚·ãƒ³ãƒ—ãƒ«æ€§**
- **MCP**: ç´”ç²‹ãªãƒ„ãƒ¼ãƒ«æä¾›ã®ã¿
- **æœ¬ä½“**: ã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ»åˆ¶å¾¡ã®è²¬ä»»
- **è²¬ä»»åˆ†é›¢**: æ˜ç¢ºãªå½¹å‰²åˆ†æ‹…

### **ãƒŸãƒ‹ãƒãƒªã‚¹ãƒˆå¯¾å¿œ**
- **é£ŸæåŠ¹ç‡**: é™ã‚‰ã‚ŒãŸé£Ÿæã®æœ€å¤§æ´»ç”¨
- **é‡è¤‡å›é¿**: åŒã˜é£Ÿæã®ä½¿ã„å›ã—é˜²æ­¢
- **å±¥æ­´ç®¡ç†**: åŒã˜ãƒ¬ã‚·ãƒ”ã®ç¹°ã‚Šè¿”ã—ã‚’é˜²æ­¢

### **å®Ÿç”¨æ€§**
- **ç¾å®Ÿçš„**: å®Ÿéš›ã®å®¶åº­ã®çŒ®ç«‹æ§‹æˆ
- **æ™‚é–“åŠ¹ç‡**: èª¿ç†æ™‚é–“ã®æœ€é©åŒ–
- **è²·ã„ç‰©ææ¡ˆ**: ä¸è¶³é£Ÿæã®æ˜ç¢ºåŒ–

### **æ‹¡å¼µæ€§**
- **æ–°ã—ã„æ¤œç´¢æ–¹æ³•**: MCPå†…ã§è¿½åŠ å¯èƒ½
- **æ–°ã—ã„åˆ¶ç´„**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§åˆ¶å¾¡å¯èƒ½
- **æ–°ã—ã„ã‚µã‚¤ãƒˆ**: Webæ¤œç´¢å¯¾è±¡ã®è¿½åŠ å¯èƒ½

### **ãƒ‡ãƒãƒƒã‚°ã®å®¹æ˜“ã•**
- **å•é¡Œã®ç‰¹å®š**: ã©ã®ãƒ„ãƒ¼ãƒ«ã§å¤±æ•—ã—ãŸã‹æ˜ç¢º
- **å€‹åˆ¥ãƒ†ã‚¹ãƒˆ**: å„ãƒ„ãƒ¼ãƒ«ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
- **ãƒ­ã‚°ç®¡ç†**: ãƒ„ãƒ¼ãƒ«å˜ä½ã§ã®ãƒ­ã‚°å‡ºåŠ›

### **è±Šå¯Œãªãƒ‡ãƒ¼ã‚¿**
- **6,234ä»¶ã®ãƒ¬ã‚·ãƒ”**: ååˆ†ãªæ¤œç´¢å¯¾è±¡
- **è©³ç´°ãªé£Ÿææƒ…å ±**: æ­£ç¢ºãªãƒãƒƒãƒãƒ³ã‚°
- **åˆ†é¡æƒ…å ±**: ã‚«ãƒ†ã‚´ãƒªãƒ™ãƒ¼ã‚¹ã®æ¤œç´¢

## ğŸ¤” æ¤œè¨ã™ã¹ãç‚¹

### **1. ç‹¬å‰µæ€§ã®å®šé‡åŒ–**
- ã©ã®ç¨‹åº¦ãŒã€Œç‹¬å‰µçš„ã ãŒå®Ÿç”¨çš„ã€ã‹ï¼Ÿ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«ã‚ˆã‚‹å­¦ç¿’ãŒå¿…è¦ï¼Ÿ

### **2. æ¤œç´¢ç²¾åº¦ã®å‘ä¸Š**
- ç”Ÿæˆã•ã‚ŒãŸã‚¿ã‚¤ãƒˆãƒ«ã§å®Ÿéš›ã«ãƒ¬ã‚·ãƒ”ãŒè¦‹ã¤ã‹ã‚‹ã‹ï¼Ÿ
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥ã®å……å®ŸãŒå¿…è¦ï¼Ÿ

### **3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
- LLMå‘¼ã³å‡ºã— + Webæ¤œç´¢ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æ¤œè¨

### **4. å“è³ªç®¡ç†**
- ç”Ÿæˆã•ã‚ŒãŸã‚¿ã‚¤ãƒˆãƒ«ã®å“è³ªè©•ä¾¡
- ä¸é©åˆ‡ãªãƒ¬ã‚·ãƒ”ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

### **5. ãƒ‡ãƒ¼ã‚¿ã®é®®åº¦**
- **å¤ã„ãƒ‡ãƒ¼ã‚¿**: æ–°ã—ã„ãƒ¬ã‚·ãƒ”ãŒå«ã¾ã‚Œãªã„
- **æ›´æ–°é »åº¦**: å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°ã®å¿…è¦æ€§
- **å“è³ªç®¡ç†**: ãƒ‡ãƒ¼ã‚¿ã®å“è³ªç¶­æŒ

### **6. ãƒ™ã‚¯ãƒˆãƒ«DBæ§‹ç¯‰**
- **åˆæœŸã‚³ã‚¹ãƒˆ**: 6,234ä»¶ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–ï¼ˆä¸€åº¦ã ã‘ï¼‰
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã‚µã‚¤ã‚º
- **æ›´æ–°é »åº¦**: æ–°ã—ã„ãƒ¬ã‚·ãƒ”ã®è¿½åŠ æ–¹æ³•

## ğŸš€ å•†ç”¨åŒ–ã®å¯èƒ½æ€§

### **MCPã¨ã—ã¦ã®ä¾¡å€¤**
- **æ±ç”¨æ€§**: ã©ã®ãƒ¬ã‚·ãƒ”ã‚µã‚¤ãƒˆã§ã‚‚åˆ©ç”¨å¯èƒ½
- **å·®åˆ¥åŒ–**: ç‹¬å‰µæ€§ + å®Ÿç”¨æ€§ã®ãƒãƒ©ãƒ³ã‚¹
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã«å¿œã˜ãŸæ‹¡å¼µ

### **å£²ã‚Šè¾¼ã¿å…ˆå€™è£œ**
- **ã‚¯ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰**: ãƒ¬ã‚·ãƒ”ææ¡ˆæ©Ÿèƒ½ã®å¼·åŒ–
- **DELISH KITCHEN**: å‹•ç”»ãƒ¬ã‚·ãƒ”ã¨ã®é€£æº
- **ã‚¯ãƒ©ã‚·ãƒ«**: åˆå¿ƒè€…å‘ã‘ãƒ¬ã‚·ãƒ”ææ¡ˆ
- **ãƒ¬ã‚·ãƒ”ãƒ–ãƒ­ã‚°**: å€‹äººãƒ–ãƒ­ã‚¬ãƒ¼å‘ã‘ãƒ„ãƒ¼ãƒ«

## ğŸ”§ ãƒ™ã‚¯ãƒˆãƒ«DBæ§‹ç¯‰ã®å®Ÿè£…ä¾‹

### **ãƒ™ã‚¯ãƒˆãƒ«DBæ§‹ç¯‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**
```python
# build_vector_db.py
import json
from langchain.embeddings import OpenAIEmbeddings
from langchain.vectorstores import Chroma

def build_recipe_vector_db():
    # 1. ãƒ¬ã‚·ãƒ”ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    recipes = load_recipe_data()
    
    # 2. ãƒ†ã‚­ã‚¹ãƒˆã®å‰å‡¦ç†
    processed_recipes = preprocess_recipes(recipes)
    
    # 3. ãƒ™ã‚¯ãƒˆãƒ«åŒ–
    embeddings = OpenAIEmbeddings()
    vectorstore = Chroma.from_texts(
        texts=[recipe['combined_text'] for recipe in processed_recipes],
        metadatas=[recipe['metadata'] for recipe in processed_recipes],
        embeddings=embeddings,
        persist_directory="./recipe_vector_db"
    )
    
    print(f"ãƒ™ã‚¯ãƒˆãƒ«DBæ§‹ç¯‰å®Œäº†: {len(processed_recipes)}ä»¶")
    return vectorstore
```

### **æ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…**
```python
# recipe_search.py
class RecipeVectorSearch:
    def __init__(self):
        self.vectorstore = Chroma(
            persist_directory="./recipe_vector_db",
            embedding_function=OpenAIEmbeddings()
        )
    
    def search_by_title(self, title: str, k: int = 5):
        results = self.vectorstore.similarity_search_with_score(
            query=title,
            k=k
        )
        return results
    
    def search_by_ingredients(self, ingredients: List[str], k: int = 5):
        query = " ".join(ingredients)
        results = self.vectorstore.similarity_search_with_score(
            query=query,
            k=k
        )
        return results
```

### **ã‚³ã‚¹ãƒˆæ¯”è¼ƒ**
```
æ¯å›APIå‘¼ã³å‡ºã—:
- æ¤œç´¢å›æ•°: 100å›/æ—¥
- ãƒ¬ã‚·ãƒ”æ•°: 6,234ä»¶
- APIæ–™é‡‘: 100å› Ã— 6,234ä»¶ Ã— $0.0001 = $62.34/æ—¥
- æœˆé¡: $1,870

äº‹å‰ãƒ™ã‚¯ãƒˆãƒ«åŒ–:
- åˆæœŸæ§‹ç¯‰: 6,234ä»¶ Ã— $0.0001 = $0.62ï¼ˆä¸€åº¦ã ã‘ï¼‰
- æ¤œç´¢æ™‚: 100å›/æ—¥ Ã— $0.0001 = $0.01/æ—¥
- æœˆé¡: $0.30

ã‚³ã‚¹ãƒˆå‰Šæ¸›: 99.98%ã®å‰Šæ¸›ï¼
```

## ğŸ”§ ç–çµåˆè¨­è¨ˆã®å®Ÿç¾

### **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹æ€§ã®å®Ÿç¾**
- **recipe_mcp**: çŒ®ç«‹ç”Ÿæˆã®ã¿ã«å°‚å¿µ
- **db_mcp**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®ã¿ã«å°‚å¿µ
- **å‘¼ã³å‡ºã—å…ƒ**: éå»ãƒ¬ã‚·ãƒ”å–å¾—ã®è²¬ä»»ã‚’è² ã†

### **è²¬ä»»åˆ†é›¢ã®å…·ä½“ä¾‹**
```python
# ç–çµåˆè¨­è¨ˆå‰ï¼ˆå¯†çµåˆï¼‰
async def generate_menu_plan_with_history(token, inventory_items):
    user_id = db_client.authenticate(token)  # â† DBæ“ä½œ
    excluded_recipes = await get_recent_recipes(user_id)  # â† DBæ“ä½œ
    menu = await generate_menu_with_llm(inventory_items, excluded_recipes)

# ç–çµåˆè¨­è¨ˆå¾Œï¼ˆç–çµåˆï¼‰
async def generate_menu_plan_with_history(inventory_items, excluded_recipes):
    menu = await generate_menu_with_llm(inventory_items, excluded_recipes)
    # éå»ãƒ¬ã‚·ãƒ”ã¯å¤–éƒ¨ã‹ã‚‰å—ã‘å–ã‚‹
```

### **ç–çµåˆã®åˆ©ç‚¹**
- **å†åˆ©ç”¨æ€§**: ä»–ã®MCPã‹ã‚‰ã‚‚åˆ©ç”¨å¯èƒ½
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆå¯èƒ½
- **ä¿å®ˆæ€§**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç‹¬ç«‹ã—ã¦å¤‰æ›´å¯èƒ½
- **æ‹¡å¼µæ€§**: æ–°ã—ã„æ©Ÿèƒ½ã‚’ç‹¬ç«‹ã—ã¦è¿½åŠ å¯èƒ½

## ğŸ“Š ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–ã¨ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

### **ä¸€èˆ¬çš„ãªæœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯**

#### **æ¥­ç•Œæ¨™æº–**
- **GPT-4o**: 128,000ãƒˆãƒ¼ã‚¯ãƒ³
- **GPT-4o-mini**: 128,000ãƒˆãƒ¼ã‚¯ãƒ³
- **Claude-3.5-Sonnet**: 200,000ãƒˆãƒ¼ã‚¯ãƒ³
- **Gemini-1.5-Pro**: 1,000,000ãƒˆãƒ¼ã‚¯ãƒ³

#### **å®Ÿç”¨çš„ãªä¸Šé™**
- **æ¨å¥¨**: 4,000-8,000ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹å“è³ªç¶­æŒï¼‰
- **è¨±å®¹**: 10,000-15,000ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆæ€§èƒ½åŠ£åŒ–ã‚ã‚Šï¼‰
- **å±é™º**: 20,000ãƒˆãƒ¼ã‚¯ãƒ³ä»¥ä¸Šï¼ˆå“è³ªå¤§å¹…ä½ä¸‹ï¼‰

#### **Morizo AIã§ã®å®Ÿç¸¾**
- **ä¿®æ­£å‰**: 1972/1500ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ131.5%è¶…éï¼‰â†’ **å±é™º**
- **ä¿®æ­£å¾Œ**: 747/1500ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ49.8%è¶…éï¼‰â†’ **è¨±å®¹ç¯„å›²å†…**
- **æ”¹å–„åŠ¹æœ**: **62%ã®å‰Šæ¸›**ï¼ˆ1972 â†’ 747ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰

### **ãƒ„ãƒ¼ãƒ«æ•°å¢—åŠ ã®å½±éŸ¿äºˆæ¸¬**
- **å®‰å…¨**: 20å€‹ä»¥ä¸‹ï¼ˆç´„800ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰
- **è¨±å®¹**: 30å€‹ä»¥ä¸‹ï¼ˆç´„1,200ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰
- **å±é™º**: 40å€‹ä»¥ä¸Šï¼ˆç´„1,600ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰

### **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–æˆ¦ç•¥**
1. **éšå±¤çš„ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: é–¢é€£ãƒ„ãƒ¼ãƒ«ã®ã¿ã‚’é¸æŠ
2. **ã‚·ãƒ³ãƒ—ãƒ«å¿œç­”ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º**: æŒ¨æ‹¶ãƒ»é›‘è«‡ã®æ—©æœŸåˆ¤å®š
3. **ãƒ„ãƒ¼ãƒ«èª¬æ˜æ–‡ã®çŸ­ç¸®**: 30æ–‡å­—ä»¥å†…ã«åˆ¶é™
4. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç©ºè¿”å´**: å®‰å…¨æ€§ã‚’å„ªå…ˆã—ãŸè¨­è¨ˆ

---

**ä½œæˆæ—¥**: 2025å¹´1æœˆ27æ—¥  
**æœ€çµ‚æ›´æ–°**: 2025å¹´9æœˆ26æ—¥  
**ä½œæˆè€…**: AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå”åƒãƒãƒ¼ãƒ   
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Phase 2å®Œäº†ï¼ˆç–çµåˆè¨­è¨ˆå®Ÿè£…æ¸ˆã¿ï¼‰  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.2ï¼ˆRAGè£œä½æ©Ÿèƒ½ãƒ»ç–çµåˆè¨­è¨ˆãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–å¯¾å¿œï¼‰
