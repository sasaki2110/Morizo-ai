# Morizo AI - レシピ提案機能 実装タスク

## 📋 概要

**タスク名**: 献立提案機能のMCP実装  
**開始日**: 2025年1月27日  
**ステータス**: 設計完了 → 実装開始  
**担当**: AIエージェント協働チーム  
**バージョン**: 1.0

## 🎯 目標

ミニマリスト対応の献立提案機能を実現するため、以下の課題を解決する：

- **献立構成**: 主菜・副菜・味噌汁の3品構成
- **食材重複回避**: 各料理で同じ食材を使用しない
- **過去履歴管理**: 過去1-2週間のレシピを除外
- **食材効率**: 限られた食材の最大活用
- **実用性**: 実際の家庭の献立構成

## 🏗️ 設計概要

### **献立提案システム**
```
在庫食材 → 献立構成（主菜・副菜・味噌汁） → 過去履歴チェック → レシピ検索 → 献立提案
```

### **MCPツール構成**
```
1. generate_menu_plan: 献立構成生成
2. check_cooking_history: 過去履歴チェック
3. search_recipe_for_menu: 献立用レシピ検索
```

## 📅 実装の優先順位

### **Phase 1: ベクトルDB構築（事前処理）** ⏳ **未着手**
- [ ] **レシピデータ前処理** - `me2you/recipe_data.jsonl`の解析・正規化
  - [ ] レシピ情報の抽出（タイトル、食材、分類）
  - [ ] 主菜・副菜・味噌汁の分類
  - [ ] 食材の正規化・標準化
- [ ] **ベクトル化** - LangChain + ChromaによるベクトルDB構築
  - [ ] OpenAI Embeddings APIの設定
  - [ ] テキストの結合（タイトル + 食材 + 分類）
  - [ ] ベクトル化の実行
- [ ] **永続化** - ローカルディスクへの保存
  - [ ] ChromaDBの永続化設定
  - [ ] ベクトルDBの保存確認
  - [ ] インデックスの最適化

### **Phase 2: 基本献立機能** ⏳ **未着手**
- [ ] **`generate_menu_plan`** - シンプルな献立構成生成
  - [ ] LLM呼び出しの実装
  - [ ] 食材配分アルゴリズム
  - [ ] 献立タイプ（和食・洋食・中華）の対応
- [ ] **`check_cooking_history`** - 過去履歴チェック
  - [ ] Supabase recipesテーブルとの連携
  - [ ] 除外期間（14日）の設定
  - [ ] レシピタイトルの部分一致チェック
- [ ] **食材配分アルゴリズム** - 重複回避のロジック
  - [ ] 主菜：メイン食材（肉・魚・卵など）
  - [ ] 副菜：野菜・きのこなど
  - [ ] 味噌汁：軽い食材・調味料

### **Phase 3: レシピ検索機能** ⏳ **未着手**
- [ ] **`search_recipe_for_menu`** - 献立用レシピ検索
  - [ ] 料理タイプ別の検索
  - [ ] 食材制約の考慮
  - [ ] 使用禁止食材の除外
- [ ] **食材制約** - 使用禁止食材の考慮
  - [ ] 他の料理で使用済み食材の管理
  - [ ] 食材の互換性チェック
- [ ] **統合検索** - Web + RAG の統合
  - [ ] Web検索（Google Search API）
  - [ ] RAG検索（事前構築済みベクトルDB）
  - [ ] 結果の統合・ランキング

### **Phase 4: 統合提案機能** ⏳ **未着手**
- [ ] **完全な献立提案** - 履歴除外済みの献立
  - [ ] 3品構成の完全な提案
  - [ ] 食材使用状況の表示
  - [ ] 残り食材の明示
- [ ] **代替案生成** - 複数の献立パターン
  - [ ] 複数の献立候補
  - [ ] ユーザー選択機能
  - [ ] 好みに応じた調整
- [ ] **買い物提案** - 不足食材の提案
  - [ ] 不足食材の特定
  - [ ] 買い物リストの生成
  - [ ] 優先度の設定

## 🔧 技術的準備

### **依存関係の追加** ⏳ **未着手**
- [ ] **LangChain** - ベクトル化とRAG検索
- [ ] **Chroma** - ベクトルデータベース
- [ ] **OpenAI Embeddings** - テキストのベクトル化
- [ ] **Google Search API** - Web検索機能
- [ ] **requirements.txt** の更新

### **テスト実装** ⏳ **未着手**
- [ ] **各ツールの単体テスト**
  - [ ] `generate_menu_plan` のテスト
  - [ ] `check_cooking_history` のテスト
  - [ ] `search_recipe_for_menu` のテスト
- [ ] **統合テスト**
  - [ ] 献立提案のエンドツーエンドテスト
  - [ ] エラーハンドリングのテスト
  - [ ] パフォーマンステスト

### **メインReActループとの統合** ⏳ **未着手**
- [ ] **ActionPlanner** の更新
  - [ ] 献立提案用のタスク分解
  - [ ] 新しいツールの認識
- [ ] **TaskManager** の更新
  - [ ] 献立提案のタスク実行
  - [ ] 依存関係の管理
- [ ] **TrueReactAgent** の更新
  - [ ] 献立提案のReActループ
  - [ ] エラーハンドリング

## 🎯 成功基準

### **Phase 1完了基準**
- [ ] ベクトルDBが正常に構築される
- [ ] 6,234件のレシピがベクトル化される
- [ ] 検索機能が正常に動作する

### **Phase 2完了基準**
- [ ] 献立構成が正常に生成される
- [ ] 過去履歴のチェックが動作する
- [ ] 食材の重複回避が機能する

### **Phase 3完了基準**
- [ ] 献立用レシピ検索が動作する
- [ ] Web検索とRAG検索が統合される
- [ ] 食材制約が適切に機能する

### **Phase 4完了基準**
- [ ] 完全な献立提案が生成される
- [ ] 代替案の生成が機能する
- [ ] 買い物提案が動作する

## 🚀 期待される効果

- **ミニマリスト対応**: 限られた食材の最大活用
- **献立の多様性**: 過去履歴管理による飽きない提案
- **実用性**: 実際の家庭の献立構成
- **食材効率**: 重複回避による無駄の削減
- **時間効率**: 調理時間の最適化

## 📝 メモ・注意事項

- 既存のMCPサーバーとの互換性を維持
- パフォーマンスへの影響を最小限に抑制
- ユーザー体験を最優先に考慮
- 段階的な実装でリスクを最小化
- 法的リスク（Web検索）の軽減策を実装

## 🔗 関連ドキュメント

- [レシピ提案機能設計](RECIPE_MCP_DESIGN.md) - 詳細な設計仕様
- [データベース設計](DDL.md) - recipesテーブルの仕様
- [開発ロードマップ](ROADMAP.md) - 全体の開発計画

---

**最終更新**: 2025年1月27日  
**バージョン**: 1.0  
**作成者**: AIエージェント協働チーム
