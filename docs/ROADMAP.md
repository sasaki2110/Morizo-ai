# Morizo AI - 開発ロードマップ

## Phase 1: 基本機能 ✅

### 完了済み
- [x] FastAPIサーバー構築
- [x] OpenAI API連携（GPT-4o-mini対応）
- [x] Supabase認証システム
- [x] 基本チャット機能
- [x] 依存関係管理（httpx互換性解決）
- [x] CORS設定
- [x] エラーハンドリング
- [x] API動作確認

## Phase 2: MCP化 ✅ **完了！**

### Supabase CRUD MCP ✅ **2025/9/22完了**
- [x] Supabase CRUD MCPサーバー作成 ✅ **2025/9/21完了**
- [x] 在庫管理の基本CRUD操作 ✅ **5つのツール実装完了**
- [x] ユーザー別データアクセス制御 ✅ **JWT認証実装完了**
- [x] **アノテーション方式のMCPサーバー** ✅ **2025/9/22完了**
- [x] **stdio接続のMCPサーバー** ✅ **2025/9/22完了**
- [x] **自動起動機能** ✅ **2025/9/22完了**
- [ ] リアルタイム更新機能
- [ ] mcp.json設定

### Recipe RAG MCP
- [ ] レシピデータのRAG化
- [ ] ベクトル検索機能
- [ ] レシピ提案システム
- [ ] 履歴管理

### Web Search MCP
- [ ] Web検索機能
- [ ] レシピ情報の取得
- [ ] データクリーニング

### Voice Processing MCP
- [ ] 音声認識機能
- [ ] 音声コマンド解析
- [ ] 音声応答生成

## Phase 3: LangChain統合 🔄 **進行中**

### MCP統合完了 ✅ **2025/9/22完了**
- [x] **main.pyへの統合** ✅ **2025/9/22完了**
- [x] **認証システムの統合** ✅ **JWT認証完了**
- [x] **自然言語での在庫管理** ✅ **動作確認完了**
- [x] **デバッグログの統合** ✅ **詳細ログ実装完了**

### LangChain統合 🔄 **2025/9/22開始**
- [ ] **依存関係の整備** - LangChainライブラリのインストール
- [ ] **MCPツールのLangChain化** - 5つのツールをLangChain Toolに変換
- [ ] **ReAct Agentの統合** - 動的ツール選択の実装
- [ ] **プロンプトテンプレートの設計** - Morizo用プロンプトの作成
- [ ] **レシピ提案機能の追加** - 食材マッチングとレシピ検索

### AI Agent Loop 🚀 **計画中**

#### Perception（認識）
- [ ] 音声入力の認識
- [ ] テキスト意図の解析
- [ ] コンテキスト理解

#### Cognition（思考）
- [ ] 意図の判断
- [ ] 適切なツールの選択
- [ ] 行動計画の立案

#### Action（行動）
- [ ] Supabase CRUD操作
- [ ] レシピ生成・提案
- [ ] Web検索実行
- [ ] レスポンス生成

## Phase 4: 高度な機能 🌟

### 状態管理
- [ ] セッション管理
- [ ] 会話履歴の保持
- [ ] ユーザー設定の管理

### 自動化
- [ ] ツール選択の自動化
- [ ] エラー回復機能
- [ ] 学習機能

### 拡張性
- [ ] プラグインシステム
- [ ] カスタムツール追加
- [ ] 外部API連携

## 技術的ToDo

### MCP実装
- [x] FastMCPでHTTP通信実装 ✅ **2025/9/21完了**
- [x] **FastMCPでstdio通信実装** ✅ **2025/9/22完了**
- [x] **自動起動機能実装** ✅ **2025/9/22完了**
- [ ] mcp.jsonでの設定管理
- [x] エラーハンドリング ✅ **CallToolResult処理完了**
- [ ] ログ管理

### データベース設計
- [x] 在庫管理テーブル設計 ✅ **DDL.mdで完了**
- [ ] レシピマスターデータ設計
- [ ] ユーザー設定テーブル設計
- [ ] インデックス最適化

### セキュリティ
- [x] Row Level Security (RLS) 設定 ✅ **DDL.mdで完了**
- [x] API権限管理 ✅ **JWT認証実装完了**
- [ ] データ暗号化

## 現在の優先度

1. **Supabase CRUD MCP** - ✅ **完全完了！**
2. **stdio接続への移行** - ✅ **完了！**
3. **main.pyへの統合** - ✅ **完了！**
4. **LangChain統合** - 🔄 **進行中**
5. **ReAct Agent実装** - 動的ツール選択
6. **レシピ提案機能** - 食材マッチングとレシピ検索

## 完了基準

### Phase 2完了基準 ✅ **達成！**
- Supabase CRUD MCPが正常動作 ✅ **完了**
- stdio接続でMCPサーバー管理 ✅ **完了**
- 基本チャット機能がMCP経由で動作 ✅ **完了**

### Phase 3完了基準
- LangChain ReAct Agentが正常動作
- 動的ツール選択が実装
- 自然言語での在庫管理とレシピ提案が可能
- エラーハンドリングが適切

---

## 🎉 Phase 2完了記念！

**2025年9月22日** - Phase 2: MCP化が完全完了！

### ✅ 達成した成果

#### **3つのMCPサーバー実装**
1. **`supabase_mcp_server.py`** - 実績のある明示的登録方式（HTTP、ポート8001）
2. **`supabase_mcp_server2.py`** - 公式チュートリアル準拠のアノテーション方式（HTTP、ポート8002）
3. **`supabase_mcp_server_stdio.py`** - **stdio接続のアノテーション方式**（軽量、自動起動）

#### **技術的達成**
- ✅ **FastMCP 2.12.3**: 最新版で安定動作
- ✅ **アノテーション方式**: `@mcp.tool()` デコレータ
- ✅ **stdio接続**: プロセス間通信で軽量動作
- ✅ **自動起動**: テスト時の手動起動が不要
- ✅ **完全なCRUD操作**: 5つのツールが全て動作
- ✅ **Supabase認証**: JWT トークン認証が正常動作
- ✅ **セキュリティ**: トークンの安全な取り扱い

#### **推奨実装**
**stdio版（`supabase_mcp_server_stdio.py`）を最優先推奨**
- 軽量、自動起動、ローカル通信、公式準拠

### 🚀 次のフェーズ

**Phase 3: LangChain統合** が開始されました！

#### **2025年9月22日の成果**
- ✅ **MCP統合完了**: main.pyにMCPクライアント機能を統合
- ✅ **認証統合**: Supabase JWT認証とMCP認証の連携
- ✅ **自然言語在庫管理**: 「冷蔵庫に牛乳を2本追加」が正常動作
- ✅ **デバッグ機能**: 詳細なログ出力で動作状況を可視化

#### **次のステップ**
- 🔄 **LangChain統合**: ReAct Agentによる動的ツール選択
- 🔄 **レシピ提案**: 食材マッチングとレシピ検索機能
- 🔄 **高度な自然言語理解**: より複雑な要求への対応

---

**最終目標**: 音声駆動型のスマートパントリーAIエージェント
