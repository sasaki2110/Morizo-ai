# Morizo AI - 最優先課題

## 📋 概要

**作成日**: 2025年9月29日  
**最終更新**: 2025年9月29日  
**バージョン**: 1.0  
**作成者**: AIエージェント協働チーム

## 🎯 最優先課題（即座に対応）

### 1. ログ出力の削減 🔥 **最優先**

#### 問題
- `morizo_ai.log` が372行以上で詳細ログが過剰
- デバッグ情報が大量に出力され、開発効率が低下
- ログファイルの肥大化による管理コストの増加

#### 影響
- 開発効率の低下
- ログファイルの肥大化
- 重要な情報の見落とし

#### 対応策
- ログレベル別の出力制御
- 重要情報のみ記録
- デバッグログの条件付き出力
- ログローテーションの改善

#### 完了基準
- [x] ログ出力量を50%以上削減
- [x] 重要な情報のみ記録
- [x] ログファイルサイズの適正化

---

### 2. README.mdの更新 🔥 **最優先**

#### 問題
- Phase 4.4が「計画中」のまま（実際は完了済み）
- 実装済み機能の記載が不正確
- ドキュメントと実装の整合性が取れていない

#### 影響
- プロジェクト理解の混乱
- 開発効率の低下
- 新規参加者の混乱

#### 対応策
- Phase 4.4を「完了」に更新
- 実装済み機能の正確な記載
- 技術スタック情報の更新

#### 完了基準
- [x] Phase 4.4の完了状況を正確に反映
- [x] 実装済み機能の正確な記載
- [x] 技術スタック情報の更新

---

### 3. 最終レスポンス生成の修正 🔥 **最優先**

#### 問題
- 献立生成・レシピ検索は正常に動作
- `_generate_final_response`で詳細結果が表示されない
- 現在は「処理が完了しました」の汎用メッセージのみ

#### 影響
- ユーザーに具体的な献立とレシピURLが提供されない
- 機能は動作しているが価値が伝わらない
- ユーザー体験の大幅な低下

#### 対応策
- `true_react_agent.py`の`_generate_final_response`メソッド修正
- 献立データとレシピデータの適切な表示実装
- 最終テストでの完全な結果表示確認

#### 完了基準
- [x] 具体的な献立内容が表示される
- [x] レシピURLが提供される
- [x] ユーザーに価値が伝わる応答

---

## 🏗️ 責任分離設計（2025年9月29日実装）

### タスク設計思想
汚いソースを整理し、明確な責任分離で再設計：

- **task1 在庫チェック**: 責任は在庫取得
- **task2 LLM推論**: in: 在庫、out: 献立（主菜・副菜・汁物）のタイトル、task1に依存、責任は献立生成
- **task3 RAG検索**: in: 在庫、out: 献立（主菜・副菜・汁物）のタイトル、task1に依存、task2と並列可能、責任は献立検索
- **task4 WEB検索**: in: LLMおよびRAGの出力したタイトル、out: 各タイトルのレシピURL、task2とtask3に依存、責任はタイトルからレシピをWEB検索

### MCPサーバー分離
- **db MCP**: 在庫データ操作（inventory_*, recipes_*）
- **recipe MCP**: 献立生成・検索・レシピ検索（generate_menu_*, search_recipe_*, search_menu_*）

---

## 🚀 高優先課題（1-2週間以内）

### 4. ドキュメント整理

#### 問題
- 完了済みドキュメントが散在
- `docs/`配下の構成が複雑
- アーカイブ化が不十分

#### 対応策
- 完了済みドキュメントのアーカイブ化
- `docs/`配下の構成最適化
- 現行ドキュメントの更新

#### 完了基準
- [x] 完了済みドキュメントのアーカイブ化完了
- [x] `docs/`配下の構成最適化完了
- [x] 現行ドキュメントの更新完了

---


## 🔧 中優先課題（1ヶ月以内）

### 5. レシピ検索統合の完成

#### 問題
- RAG検索とWeb検索は個別に動作
- 結果の統合・ランキング機能が未実装
- 最適なレシピ選択ができない

#### 対応策
- RAG検索結果とWeb検索結果の統合
- 結果の統合・ランキング機能の実装
- 最適なレシピ選択アルゴリズムの実装

#### 完了基準
- [ ] RAG検索とWeb検索の統合完了
- [ ] 結果の統合・ランキング機能実装
- [ ] 最適なレシピ選択アルゴリズム実装

#### 進捗状況
- [x] 配列対応レシピ検索の実装完了（2025年9月29日）
- [x] 主菜・副菜・汁物の個別レシピ検索機能実装
- [x] 複数レシピURLの表示機能実装
- [x] 統合テスト成功（3/3）

---

### 6. 並列実行の最適化

#### 問題
- 基本的な並列実行は実装済み
- 依存関係エラーの改善余地
- パフォーマンスの最適化余地

#### 対応策
- 依存関係エラーの改善
- 並列実行の最適化
- パフォーマンスの向上

#### 完了基準
- [ ] 依存関係エラーの改善完了
- [ ] 並列実行の最適化完了
- [ ] パフォーマンスの向上確認

---

## 📊 進捗管理

### 完了済み
- [x] 技術スタックの整理（2025年9月29日完了）

### 完了
- [x] ログ出力の削減
- [x] README.mdの更新
- [x] ドキュメント整理
- [x] 最終レスポンス生成の修正
- [x] 配列対応レシピ検索の実装（2025年9月29日）
- [x] **Phase 4.5 並列提示システム**の完全実装（2025年9月29日）
- [x] **レシピ検索統合**の完成（斬新な提案 vs 伝統的な提案実装）

### 進行中
- [x] **並列実行の最適化**の改善（2025年9月29日完了）

### 未着手
- [ ] パフォーマンスの向上確認


---

## 🎯 成功基準

### 最優先課題完了基準
- [x] ログ出力量を50%以上削減
- [x] README.mdの正確な更新
- [x] 具体的な献立とレシピURLの表示

### 高優先課題完了基準
- [x] ドキュメント整理の完了

### 中優先課題完了基準
- [x] レシピ検索の精度向上（主菜・副菜・汁物それぞれの具体的なレシピURL提供）
- [x] **レシピ検索統合の完成**（斬新な提案 vs 伝統的な提案の並列提示システム）
- [x] 並列実行の最適化完了（2025年9月29日）


---

## 🚀 期待される効果

### 最優先課題完了時
- **開発効率の向上**: ログ管理の改善
- **プロジェクト理解の向上**: 正確なドキュメント
- **ユーザー体験の向上**: 価値のある応答

### 全課題完了時
- **プロジェクト管理の最適化**: 整理されたドキュメント
- **機能完成度の向上**: ロールバック機能の実装
- **パフォーマンスの向上**: 最適化された実行

---

## 📝 メモ・注意事項

- 最優先課題は即座に対応が必要
- 高優先課題は1-2週間以内に対応
- 中優先課題は1ヶ月以内に対応
- 各課題の完了基準を明確に設定
- 進捗管理を定期的に更新

---

**最終更新**: 2025年9月29日  
**バージョン**: 1.2  
**作成者**: AIエージェント協働チーム

## 📝 更新履歴

### v1.3 (2025年9月29日)
- ✅ **MCPツール切り分け修正**: `search_menu_from_rag_with_history`の正しいサーバー割り当て
- ✅ **Token validation修正**: パラメータエラーの完全解決
- ✅ **並列実行の最適化**: 依存関係エラーの改善完了
- ✅ **完全動作確認**: 3/3テスト成功 (100%)

### v1.2 (2025年9月29日)
- ✅ **Phase 4.5 並列提示システム**: 完全実装・検証完了
- ✅ **斬新な提案 vs 伝統的な提案**: 完全動作
- ✅ **レシピ検索統合**: Web検索とRAG検索の統合完了
- ✅ **統合テスト**: 3/3成功 (100%)

### v1.1 (2025年9月29日)
- 最終レスポンス生成の修正完了を反映
- 配列対応レシピ検索の実装完了を追加
- レシピ検索の精度向上（主菜・副菜・汁物の個別レシピURL提供）完了を反映
- 進捗管理セクションの更新
